$((function(){$("#trainer").each((function(){var e,t,n,o,a=$(this),r=$(".coord-trainer__board .cg-wrap"),i=$(".coord-trainer__side"),s=$(".coord-trainer__table"),c=a.find(".progress_bar"),d=[$("#next_coord0"),$("#next_coord1"),$("#next_coord2")],l=s.find(".start"),f=s.find(".explanation"),h=$(".coord-trainer__score"),u=a.data("score-url"),x=a.data("color-pref"),v=function(){t="random"==x?["white","black"][Math.round(Math.random())]:x,e?t!==e.state.orientation&&e.toggleOrientation():e=Chessground(r[0],{coordinates:!1,drawable:{enabled:!1},movable:{free:!1,color:null},orientation:t,addPieceZIndex:$("#main-wrap").hasClass("is3d")}),a.removeClass("white black").addClass(t)};v(),a.find("form.color").each((function(){var e=$(this);e.find("input").on("change",(function(){var t={1:"white",2:"random",3:"black"}[e.find("input:checked").val()];return t!==x&&$.ajax(window.lichess.formAjax(e)),x=t,v(),!1}))}));var m=function(){var e=$("body").hasClass("dark"),t={type:"line",width:"100%",height:"80px",lineColor:e?"#4444ff":"#0000ff",fillColor:e?"#222255":"#ccccff"};i.find(".user_chart").each((function(){$(this).sparkline($(this).data("points"),t)}))};m();var p=function(){s.css("top",256-s.height()/2+"px")};p();var g=function(){$.each(d,(function(e,t){t.text("")}))},_=function(e){var t="abcdefgh",n=t.indexOf(e[0]);t=t.slice(0,n)+t.slice(n+1,8);var o="12345678",a=o.indexOf(e[1]);return o=o.slice(0,a)+o.slice(a+1,8),t[Math.round(Math.random()*(t.length-1))]+o[Math.round(Math.random()*(o.length-1))]},w=function(){var r=Math.min(3e4,new Date-n);c.css("width",100*r/3e4+"%"),r<3e4?setTimeout(w,50):(g(),a.removeClass("play"),p(),a.removeClass("wrong"),e.set({events:{select:!1}}),u&&$.ajax({url:u,method:"post",data:{color:t,score:o},success:function(e){i.find(".scores").html(e),m()}}))};l.click((function(){f.remove(),a.addClass("play").removeClass("init"),v(),g(),p(),o=0,h.text(o),c.css("width",0),setTimeout((function(){var t;for(n=new Date,e.set({events:{select:function(e){var t=e==d[0].text();t?(o++,h.text(o),function(){$("#next_coord0").removeClass("nope");var e=d.shift();$.each(d,(function(e,t){t.attr("id","next_coord"+e)})),e.attr("id","next_coord"+d.length),e.text(_(d[d.length-1].text())),d.push(e)}()):($("#next_coord0").addClass("nope"),setTimeout((function(){$("#next_coord0").removeClass("nope")}),500)),a.toggleClass("wrong",!t)}}}),d[0].text(_("a1")),t=1;t<d.length;t++)d[t].text(_(d[t-1].text()));w()}),1e3)}))}))}));