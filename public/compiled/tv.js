function parseFen(e){e.each((function(){var e=$(this).removeClass("parse-fen"),t=e.data("lastmove"),a=e.data("color"),n=e.data("chessground"),r={coordinates:!1,resizable:!1,drawable:{enabled:!1,visible:!1},viewOnly:!0,fen:e.data("fen"),lastMove:t&&[t[0]+t[1],t[2]+t[3]]};a&&(r.orientation=a),n?n.set(r):(this.innerHTML='<div class="cg-wrap"></div>',e.data("chessground",Chessground(this.firstChild,r)))}))}function resize(){var e=document.querySelector("#featured-game");e.offsetHeight>window.innerHeight&&(e.style.maxWidth=window.innerHeight-e.querySelector(".vstext").offsetHeight+"px")}$((function(){var e=$("#featured-game"),t=function(){return e.find(".mini-board")};(parseFen(t()),window.EventSource)&&(new EventSource($("body").data("stream-url")).addEventListener("message",(function(a){var n=JSON.parse(a.data);"featured"==n.t?(e.html(n.d.html).find("a").attr("target","_blank"),parseFen(t())):"fen"==n.t&&parseFen(t().data("fen",n.d.fen).data("lastmove",n.d.lm))}),!1),resize(),window.addEventListener("resize",resize))}));