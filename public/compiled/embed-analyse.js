function toYouTubeEmbedUrl(e){if(e){var t=e.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch)?(?:\?v=)?([^"&?/ ]{11})(?:\?|&|)(\S*)/i);if(t){var n=1;t[2].split("&").forEach((function(e){var t=e.split("=");if("t"===t[0]||"start"===t[0])if(t[1].match(/^\d+$/))n=parseInt(t[1]);else{var r=t[1].match(/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?/);n=3600*(parseInt(r[1])||0)+60*(parseInt(r[2])||0)+(parseInt(r[3])||0)}}));var r="modestbranding=1&rel=0&controls=2&iv_load_policy=3&start="+n;return"https://www.youtube.com/embed/"+t[1]+"?"+r}}}$((function(){var e=window.location.host,t=new RegExp(e+"/study/(?:embed/)?(\\w{8})/(\\w{8})(#\\d+)?\\b"),n=new RegExp(e+"/(?:embed/)?(\\w{8})(?:(?:/(white|black))|\\w{4}|)(#\\d+)?\\b"),r=["training","analysis","insights","practice","features","password","streamer"],a=function(e,t){var n=e.shift();t=Math.min(1500,t||100);n&&function(e){var t=$('<div class="embed"><iframe src="'+e.src+'"></iframe></div>');return $(e.element).replaceWith(t),t}(n).find("iframe").on("load",(function(){setTimeout((function(){a(e,t+200)}),t)}))},i=function(e){var t=$("<iframe>").addClass("analyse "+e.type).attr("src",e.src);return $(e.element).replaceWith($('<div class="embed"></div>').html(t)),t.on("load",(function(){this.contentDocument.title.startsWith("404")&&(this.style.height="100px")})).on("mouseenter",(function(){$(this).focus()}))},s=function(e,t){var n=e.shift();t=Math.min(1500,t||100);n&&i(n).on("load",(function(){setTimeout((function(){s(e,t+200)}),t)}))};var o=["blue","blue2","blue3","blue-marble","canvas","wood","wood2","wood3","wood4","maple","maple2","brown","leather","green","marble","green-plastic","grey","metal","olive","newspaper","purple","purple-diag","pink","ic"],c=function(e){if(e.includes("://"))return e;var t=new URL(e,window.location.href);return t.searchParams.append("theme",o.find((function(e){return document.body.classList.contains(e)}))),t.searchParams.append("bg",document.body.getAttribute("data-theme")),t.href},u=$(".embed_analyse a").toArray().map((function(e){var a=function(e){var a,i=toYouTubeEmbedUrl(e.href);if(i)return{type:"youtube",src:i};if((a=e.href.match(t))&&a[2]&&e.text.match(t))return{type:"study",src:"/study/embed/"+a[1]+"/"+a[2]+(a[3]||"")};if((a=e.href.match(n))&&a[1]&&!r.includes(a[1])&&e.text.match(n)){var s="/embed/"+a[1];return a[2]&&(s+="/"+a[2]),a[3]&&(s+=a[3]),{type:"game",src:s}}}(e);return!!a&&{element:e,parent:e.parentNode,type:a.type,src:c(a.src)}})).filter((function(e){return e}));a(u.filter((function(e){return"youtube"===e.type}))),s(u.filter((function(e){return"study"===e.type})).map((function(e){return e.element.classList.add("embedding_analyse"),e.element.innerHTML=lichess.spinnerHtml,e}))),function(e){(function(e){var t=[],n={parent:null,index:-1};return e.forEach((function(e){e.parent===n.parent?t[n.index].push(e):(n={parent:e.parent,index:n.index+1},t[n.index]=[e])})),t})(e).forEach((function(e){e.length<3?e.forEach(i):e.forEach((function(e){e.element.title="Click to expand",e.element.classList.add("text"),e.element.setAttribute("data-icon","="),e.element.addEventListener("click",(function(t){0===t.button&&(t.preventDefault(),i(e))}))}))}))}(u.filter((function(e){return"game"===e.type})))})),lichess.startEmbeddedAnalyse=function(e){document.body.classList.toggle("supports-max-content",!!window.chrome),e.socketSend=$.noop,e.initialPly="url",e.trans=lichess.trans(e.i18n),LichessAnalyse.start(e),window.addEventListener("resize",(function(){lichess.dispatchEvent(document.body,"chessground.resize")}))};